<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小R - AI助手</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script>
        // 检查用户是否已经看过新年祝福
        const newYearGreetingSeen = localStorage.getItem('newYearGreetingSeen');
        const today = new Date().toDateString();
        
        // 如果用户今天还没有看过新年祝福，则重定向到新年祝福页面
        if (newYearGreetingSeen !== today) {
            window.location.href = 'new-year-greeting.html';
        }
        // 否则直接加载当前页面（即原来的主界面）
    </script>
</head>
<body>

    <div class="container">
        <header>
            <h1>小R - AI助手</h1>
            <div class="header-buttons">
                <button id="newChatButton" class="new-chat-btn">新对话</button>
                <button id="chatListButton" class="chat-list-btn">对话列表</button>
                <button id="settingsButton" class="settings-btn">⚙️</button>
            </div>
        </header>
        
        <!-- 对话列表侧边栏 -->
        <div id="chatListSidebar" class="chat-list-sidebar">
            <div class="chat-list-header">
                <h3>对话列表</h3>
                <button id="closeChatList" class="close-chat-list-btn">x</button>
            </div>
            <div id="chatList" class="chat-list"></div>
        </div>
        
        <!-- 设置面板 -->
        <div id="settingsPanel" class="settings-panel">
            <div class="settings-content">
                <span id="closeSettings" class="close-settings-btn">&times;</span>
                
                <!-- 设置标签页 -->
                <div class="settings-tabs">
                    <button class="tab-button active" data-tab="ai-settings">AI设置</button>
                    <button class="tab-button" data-tab="app-settings">应用设置</button>
                    <button class="tab-button" data-tab="update-extend">更新与扩展</button>
                </div>
                
                <!-- AI设置栏目 -->
                <div id="ai-settings" class="settings-tab-content active">
                    <div class="setting-item">
                        <label for="aiModelSelect">AI模型:</label>
                        <select id="aiModelSelect">
                            <option value="deepseek">DeepseekV3.2</option>
                            <option value="claude">豆包</option>
                            <option value="yuanbao">腾讯元宝</option>
                            <option value="qwen3">Qwen3</option>
                            <option value="ling">蚂蚁Ling2.0</option>
                            <option value="gemini">Gemini-2.5</option>
                            <option value="glm">GLM</option>
                            <option value="custom">自定义模型</option>
                            <option value="ollama">Ollama本地模型</option>
                        </select>
                        <div id="modelAvailabilityInfo" class="model-availability-info" style="margin-top: 5px; font-size: 0.8em; color: #666; display: none;">
                            <span id="modelUnavailableCount"></span>
                            <button id="ignoreModelErrorBtn" class="ignore-model-error-btn" style="margin-left: 10px; padding: 2px 8px; font-size: 0.8em; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">忽略错误</button>
                        </div>
                    </div>
                    
                    <div id="customModelSettings" class="setting-item" style="display: none;">
                        <label for="customModelUrl">自定义模型API接口:</label>
                        <input type="text" id="customModelUrl" placeholder="https://www.ai.com/Deepseek.php?q=%提问内容%&s=%联想词%">
                        <div class="custom-model-help">
                            参数说明：<br>
                            %提问内容% - 替换为用户的问题<br>
                            %联想词% - 替换为system提示词
                        </div>
                    </div>
                    
                    <div class="setting-item">
                        <label for="contextSelect">上下文对话数量:</label>
                        <select id="contextSelect">
                            <option value="0">不启用上下文</option>
                            <option value="2">1轮对话（用户+AI）</option>
                            <option value="4" selected>2轮对话（用户+AI）</option>
                            <option value="6">3轮对话（用户+AI）</option>
                            <option value="8">4轮对话（用户+AI）</option>
                            <option value="10">5轮对话（用户+AI）</option>
                            <option value="all">完整历史</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="voiceToggle" checked> 启用AI语音回复
                        </label>
                    </div>
                    
                    <div id="voiceTypeSetting" class="setting-item" style="display: none;">
                        <label for="voiceTypeSelect">音色选择:</label>
                        <select id="voiceTypeSelect">
                            <option value="">默认女声</option>
                            <option value="zh-HK-HiuGaaiNeural">粤语女声 - 粤爱</option>
                            <option value="zh-HK-HiuMaanNeural">粤语女声 - 粤曼</option>
                            <option value="zh-HK-WanLungNeural">粤语男声 - 粤龙</option>
                            <option value="zh-CN-XiaoxiaoNeural">普通话女声 - 晓晓</option>
                            <option value="zh-CN-XiaoyiNeural">普通话女声 - 晓伊</option>
                            <option value="zh-CN-YunjianNeural">普通话男声 - 云健</option>
                            <option value="zh-CN-YunxiNeural">普通话男声 - 云希</option>
                            <option value="zh-CN-YunxiaNeural">普通话男声 - 云夏</option>
                            <option value="zh-CN-YunyangNeural">普通话男声 - 云扬</option>
                            <option value="zh-CN-liaoning-XiaobeiNeural">东北女声 - 晓北</option>
                            <option value="zh-TW-HsiaoChenNeural">台语女声 - 晓臻</option>
                            <option value="zh-TW-YunJheNeural">台语男声 - 云哲</option>
                            <option value="zh-TW-HsiaoYuNeural">台语女声 - 晓雨</option>
                            <option value="zh-CN-shaanxi-XiaoniNeural">陕西女声 - 晓妮</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="animationOutputToggle"> 启用动画输出（逐字显示）
                        </label>
                    </div>
                    
                    <div id="weatherApiKeySetting" class="setting-item">
                        <label for="weatherApiKeyInput">天气API密钥:</label>
                        <input type="password" id="weatherApiKeyInput" placeholder="输入您的API密钥">
                    </div>
                    
                    <div id="ollamaSettings" class="setting-item" style="display: none;">
                        <h4>Ollama本地模型设置</h4>
                        
                        <div class="ollama-setting-row">
                            <label for="ollamaServerUrl">Ollama服务器地址:</label>
                            <input type="text" id="ollamaServerUrl" placeholder="http://localhost:11434">
                            <button id="testOllamaConnection" class="test-btn">测试连接</button>
                        </div>
                        
                        <div class="ollama-setting-row">
                            <div class="connection-status">
                                <span id="ollamaConnectionStatus">未连接</span>
                                <span id="ollamaConnectionIndicator" class="status-indicator"></span>
                            </div>
                        </div>
                        
                        <div class="ollama-setting-row">
                            <label for="ollamaModelSelect">选择模型:</label>
                            <select id="ollamaModelSelect">
                                <option value="">-- 请先连接服务器 --</option>
                            </select>
                            <button id="refreshOllamaModels" class="refresh-btn">刷新模型列表</button>
                        </div>
                    </div>
                </div>
                
                <!-- 应用设置栏目 -->
                <div id="app-settings" class="settings-tab-content">
                    <div class="setting-item">
                        <label for="themeSelect">主题:</label>
                        <select id="themeSelect">
                            <option value="light">浅色</option>
                            <option value="dark">深色</option>
                            <option value="system">跟随系统</option>
                            <option value="newyear">新年主题</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="snowToggle"> 启用新年雪花特效
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="autoLaunchToggle"> 开机自启动
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="floatingBallToggle"> 显示悬浮球
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="closeToExitToggle"> 关闭时直接退出
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label>快捷键:</label>
                        <div class="shortcut-input-container">
                            <span id="shortcutPrefix" class="shortcut-prefix">Ctrl+Alt+</span>
                            <input type="text" id="shortcutKeyInput" placeholder="R" value="R" maxlength="1">
                        </div>
                        <button id="setShortcutButton" class="set-shortcut-btn">设置快捷键</button>
                        <small>提示: 在输入框中输入单个按键</small>
                    </div>
                    

                </div>
                
                <!-- 更新与扩展栏目 -->
                <div id="update-extend" class="settings-tab-content">
                    <div class="setting-item">
                        <h3>扩展</h3>
                        <div class="extend-section">
                            <p>扩展Ruanm自研模型RenMinix</p>
                            <p>&nbsp;</p>
                            <button id="extendModelButton" class="extend-btn">扩展模型</button>
                            <div id="extendProgress" class="extend-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div id="progressFill" class="progress-fill"></div>
                                </div>
                                <p>&nbsp;</p>
                                <div id="progressText" class="progress-text">0%</div>
                            </div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <h3>更新</h3>
                        <p>当前版本: v1.1.2</p>
                        <p>&nbsp;</p>
                        <button id="checkUpdateButton" class="update-btn">检查更新</button>
                    </div>
                </div>
                
                <div class="settings-buttons">
                    <button id="saveSettings" class="save-btn">保存设置</button>
                    <button id="clearDataButton" class="clear-data-btn">清除所有数据</button>
                </div>
            </div>
        </div>
        
        <main>
            <div class="chat-container">
                <div class="chat-history" id="chatHistory">
                    <!-- 聊天记录将在这里显示 -->
                </div>
                
                <div class="input-area">
                    <div class="input-with-buttons">
                        <textarea 
                            id="userInput" 
                            placeholder="和小R聊天..." 
                            rows="3"
                        ></textarea>
                        <button id="voiceInputButton" class="inline-voice-btn" title="语音输入（在Electron环境中可能需要系统级权限）">🎤</button>
                        <div class="input-bottom-left">
                            <button id="skillButton" class="skill-btn-main" title="技能">💡技能</button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="sendButton">发送</button>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <button id="stopVoiceButton" class="stop-voice-btn">停止说话</button>
    
    <!-- 技能弹出菜单 -->
    <div id="skillMenu" class="skill-menu" style="display: none;">
        <button id="imageGenMenuButton" class="skill-menu-btn" title="AI图片生成">🖼️ 图片生成</button>
        <button id="imageOcrMenuButton" class="skill-menu-btn" title="图片OCR识别">🔍 OCR识别</button>
        <button id="translationMenuButton" class="skill-menu-btn" title="翻译助手">🌐 翻译</button>
        <button id="codeAssistantMenuButton" class="skill-menu-btn" title="AI编程助手">💻 编程</button>
        <button id="weatherMenuButton" class="skill-menu-btn" title="天气查询">🌤️ 天气查询</button>
    </div>
    
    <!-- 自定义提示框 -->
    <div id="customAlert" class="custom-alert" style="display: none;">
        <div class="alert-content">
            <div class="alert-header">
                <span class="alert-title" id="alertTitle">提示</span>
                <span class="alert-close" id="alertClose">&times;</span>
            </div>
            <div class="alert-body">
                <p id="alertMessage"></p>
            </div>
            <div class="alert-footer">
                <button id="alertConfirm" class="alert-btn">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 自定义确认框 -->
    <div id="customConfirm" class="custom-confirm" style="display: none;">
        <div class="confirm-content">
            <div class="confirm-header">
                <span class="confirm-title" id="confirmTitle">确认</span>
                <span class="confirm-close" id="confirmClose">&times;</span>
            </div>
            <div class="confirm-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="confirm-footer">
                <button id="confirmCancel" class="confirm-btn cancel-btn">取消</button>
                <button id="confirmOk" class="confirm-btn ok-btn">确定</button>
            </div>
        </div>
    </div>
    
    <!-- 自定义输入框 -->
    <div id="customPrompt" class="custom-prompt" style="display: none;">
        <div class="prompt-content">
            <div class="prompt-header">
                <span class="prompt-title" id="promptTitle">输入</span>
                <span class="prompt-close" id="promptClose">&times;</span>
            </div>
            <div class="prompt-body">
                <p id="promptMessage"></p>
                <input type="text" id="promptInput" class="prompt-input">
            </div>
            <div class="prompt-footer">
                <button id="promptCancel" class="prompt-btn cancel-btn">取消</button>
                <button id="promptOk" class="prompt-btn ok-btn">确定</button>
            </div>
        </div>
    </div>
    
    <script src="clearData.js"></script>
        <script src="weather-test.js"></script>
        <script src="renderer.js"></script>
</body>
</html>