<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
      overflow: hidden;
    }
    .ball {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      user-select: none;
      position: relative;
      overflow: hidden;
      z-index: 9999;
    }
    .ball:hover {
      background: linear-gradient(145deg, #357ae8, #2a6ac5);
    }
    .ball:active {
      transform: scale(0.95);
    }
    .ball {
      -webkit-user-drag: none;
      -webkit-app-region: no-drag;
    }
    

  </style>
</head>
<body>
  <div class="ball">
    <img src="floating-ball-icon.png" alt="App Icon" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover; -webkit-user-drag: none;">
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    
    document.addEventListener('DOMContentLoaded', function() {
      const ball = document.querySelector('.ball');

      // 点击悬浮球打开或关闭迷你输入框窗口
      if (ball) {
        ball.addEventListener('click', function(event) {
          console.log('悬浮球点击事件触发，事件目标:', event.target, '事件当前目标:', event.currentTarget);
          
          // 发送IPC消息到主进程，请求切换迷你输入框窗口
          ipcRenderer.send('toggle-mini-input-window');
          
          // 阻止事件冒泡，防止触发其他处理程序
          event.stopPropagation();
          event.preventDefault();
        });
        
        // 右键点击事件，显示菜单
        ball.addEventListener('contextmenu', function(event) {
          event.preventDefault(); // 阻止默认右键菜单
          
          // 发送IPC消息到主进程，请求显示右键菜单
          ipcRenderer.send('show-floating-ball-context-menu', event.clientX, event.clientY);
        });
      }
      
      // 窗口拖拽功能
      let isDragging = false;
      let offsetX, offsetY;
      
      ball.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        
        document.addEventListener('mousemove', onMouseMove);
        document.addEventListener('mouseup', onMouseUp);
      });
      
      function onMouseMove(e) {
        if (!isDragging) return;
        
        const x = e.screenX - offsetX;
        const y = e.screenY - offsetY;
        
        if (window.require) {
          const { ipcRenderer } = require('electron');
          ipcRenderer.send('move-floating-ball', x, y);
        }
      }
      
      function onMouseUp() {
        isDragging = false;
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }
    });
    
    // 添加DevTools快捷键支持
    document.addEventListener('keydown', function(event) {
      // 检测 Ctrl+Shift+I 或 F12 组合键
      if ((event.ctrlKey && event.shiftKey && event.key === 'I') || 
          (event.key === 'F12')) {
        event.preventDefault();
        if (window.require) {
          const { remote } = require('electron');
          const webContents = remote.getCurrentWebContents();
          webContents.openDevTools();
        }
      }
    });
  </script>
</body>
</html>