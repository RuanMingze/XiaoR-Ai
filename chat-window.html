<!-- 此文件被暂时废弃 -->
<!DOCTYPE html>
<html>
<head>
  <style>
    .warning {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #ff6b6b;
      color: white;
      text-align: center;
      padding: 10px;
      font-size: 16px;
      font-weight: bold;
      z-index: 10000;
    }
    .chat-container {
      margin-top: 40px; /* 为警告条留出空间 */
    }
    body {
      margin: 0;
      padding: 0;
      background: white;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    .chat-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }
    .chat-header {
      background: #4a90e2;
      color: white;
      padding: 8px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
      font-size: 14px;
    }
    .chat-body {
      flex: 1;
      padding: 8px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    .chat-input {
      display: flex;
      padding: 8px;
      background: white;
      border-top: 1px solid #eee;
      flex-shrink: 0;
    }
    .chat-input input {
      flex: 1;
      padding: 4px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 5px;
      font-size: 14px;
    }
    .chat-input button {
      padding: 4px 8px;
      background: #4a90e2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="warning">此文件是暂时废弃的，可以点击任意位置查看</div>
  <div class="chat-container">
    <div class="chat-header">
      <span>小R AI助手</span>
      <button onclick="closeWindow()" style="background: none; border: none; color: white; font-size: 16px; cursor: pointer;">×</button>
    </div>
    <div class="chat-body" id="chatBody">
      <div>你好！我是小R AI助手，请问有什么可以帮助你的？</div>
    </div>
    <div class="chat-input">
      <input type="text" id="userInput" placeholder="输入消息..." onkeypress="handleKeyPress(event)">
      <button onclick="sendMessage()">发送</button>
    </div>
  </div>
  <script>
    const { ipcRenderer } = require('electron');
    
    // 关闭窗口
    function closeWindow() {
      window.close();
    }
    
    // 发送消息
    function sendMessage() {
      const input = document.getElementById('userInput');
      const message = input.value.trim();
      
      if (message) {
        const chatBody = document.getElementById('chatBody');
        
        // 添加用户消息
        const userMessage = document.createElement('div');
        userMessage.textContent = '我: ' + message;
        userMessage.style.textAlign = 'right';
        userMessage.style.marginBottom = '10px';
        userMessage.style.padding = '5px 10px';
        userMessage.style.backgroundColor = '#4a90e2';
        userMessage.style.color = 'white';
        userMessage.style.borderRadius = '10px';
        userMessage.style.display = 'inline-block';
        userMessage.style.maxWidth = '80%';
        userMessage.style.float = 'right';
        chatBody.appendChild(userMessage);
        
        // 清空输入框
        input.value = '';
        
        // 滚动到底部
        chatBody.scrollTop = chatBody.scrollHeight;
        
        // 添加"正在思考"消息
        const thinkingMessage = document.createElement('div');
        thinkingMessage.id = 'thinkingMessage';
        thinkingMessage.textContent = '小R: 正在思考...';
        thinkingMessage.style.textAlign = 'left';
        thinkingMessage.style.marginBottom = '10px';
        thinkingMessage.style.padding = '5px 10px';
        thinkingMessage.style.backgroundColor = '#e0e0e0';
        thinkingMessage.style.borderRadius = '10px';
        thinkingMessage.style.display = 'inline-block';
        thinkingMessage.style.maxWidth = '80%';
        thinkingMessage.style.float = 'left';
        chatBody.appendChild(thinkingMessage);
        
        // 滚动到底部
        chatBody.scrollTop = chatBody.scrollHeight;
        
        // 调用AI API
        callAI(message);
      }
    }
    
    // 调用AI API的函数
    async function callAI(question) {
      const chatBody = document.getElementById('chatBody');
      
      try {
        // 从本地存储获取当前设置
        const savedSettings = localStorage.getItem('xiaor-settings');
        let aiModel = 'deepseek'; // 默认为Deepseek
        let settings = null; // 定义settings变量
        
        if (savedSettings) {
          settings = JSON.parse(savedSettings);
          aiModel = settings.aiModel || 'deepseek';
        }
        
        // 根据AI模型选择API端点
        let apiEndpoint = 'https://api.jkyai.top/API/depsek3.2.php'; // 默认为Deepseek
        if (aiModel === 'claude') {
          apiEndpoint = 'https://api.jkyai.top/API/doubao.php'; // 豆包
        } else if (aiModel === 'yuanbao') {
          apiEndpoint = 'https://api.jkyai.top/API/yuanbao.php'; // 腾讯元宝
        } else if (aiModel === 'qwen3') {
          apiEndpoint = 'https://api.jkyai.top/API/qwen3.php'; // Qwen3
        } else if (aiModel === 'custom') {
          // 自定义模型：从设置中获取API URL
          if (settings && settings.customModelUrl) {
            apiEndpoint = settings.customModelUrl;
          }
        }
        
        // 构建请求数据
        const requestData = {
          ques: question,
          system: '你是Ruanm开发的小R-Ai助手，专注于帮用户解决各种难题、聊天。',
          apiEndpoint: apiEndpoint
        };
        
        // 通过 Electron API 发送请求
        const response = await ipcRenderer.invoke('send-ai-request', requestData);
        
        // 移除"正在思考"消息
        const thinkingMessage = document.getElementById('thinkingMessage');
        if (thinkingMessage) {
          thinkingMessage.remove();
        }
        
        // 添加AI回复
        const aiMessage = document.createElement('div');
        aiMessage.textContent = '小R: ' + response;
        aiMessage.style.textAlign = 'left';
        aiMessage.style.marginBottom = '10px';
        aiMessage.style.padding = '5px 10px';
        aiMessage.style.backgroundColor = '#e0e0e0';
        aiMessage.style.borderRadius = '10px';
        aiMessage.style.display = 'inline-block';
        aiMessage.style.maxWidth = '80%';
        aiMessage.style.float = 'left';
        chatBody.appendChild(aiMessage);
        
        // 滚动到底部
        chatBody.scrollTop = chatBody.scrollHeight;
      } catch (error) {
        // 移除"正在思考"消息
        const thinkingMessage = document.getElementById('thinkingMessage');
        if (thinkingMessage) {
          thinkingMessage.remove();
        }
        
        // 显示错误消息
        const errorMessage = document.createElement('div');
        errorMessage.textContent = '小R: 请求失败 - ' + error.message;
        errorMessage.style.textAlign = 'left';
        errorMessage.style.marginBottom = '10px';
        errorMessage.style.padding = '5px 10px';
        errorMessage.style.backgroundColor = '#ff6b6b';
        errorMessage.style.color = 'white';
        errorMessage.style.borderRadius = '10px';
        errorMessage.style.display = 'inline-block';
        errorMessage.style.maxWidth = '80%';
        errorMessage.style.float = 'left';
        chatBody.appendChild(errorMessage);
        
        // 滚动到底部
        chatBody.scrollTop = chatBody.scrollHeight;
      }
    }
    
    // 处理回车键
    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        sendMessage();
      }
    }
    
    // 添加点击任意位置查看的功能
    document.addEventListener('click', function(event) {
      // 只有点击警告条以外的区域才有效
      const warningElement = document.querySelector('.warning');
      if (warningElement && !warningElement.contains(event.target)) {
        document.body.style.opacity = '0.8';
        setTimeout(() => {
          document.body.style.opacity = '1';
        }, 100);
      }
    });
  </script>
</body>
</html>